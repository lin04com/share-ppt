<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="javascript错误与代码规范">Javascript错误与代码规范</h1>
<h2 id="内容提要">内容提要</h2>
<ol type="1">
<li>JS错误处理</li>
</ol>
<ul>
<li>常见JS错误</li>
<li>Javascript错误监控机制</li>
<li>PE统计</li>
</ul>
<ol start="2" type="1">
<li>代码规范</li>
</ol>
<ul>
<li>为什么要规范代码?</li>
<li>规范好处</li>
<li>JS代码规范及基本错误处理</li>
</ul>
<ol start="3" type="1">
<li>总结</li>
</ol>
<ul>
<li>注意代码规范，代码风格一致，方便维护</li>
<li>使用工具及时检测发现错误</li>
</ul>
<h3 id="常见js错误">常见JS错误</h3>
<ul>
<li>运行时异常
<ol type="1">
<li><a href="demo/1.html">无法设置属性“XXX”的值: 对象为 null 或未定义</a></li>
<li><a href="demo/2.html">SCRIPT1028: 缺少标识符、字符串或数字</a></li>
<li><a href="demo/3.html">缺少函数</a></li>
<li><a href="demo/4.html">'XXX' 为空或不是对象</a></li>
<li><a href="demo/5.html">'XXX' 未定义</a></li>
<li><a href="demo/6.html">缺少 'XXX'</a></li>
</ol>
<ul>
<li>缺少 ']'</li>
<li>必須要有 ']'</li>
<li>缺少 '}'</li>
<li>缺少 ':'</li>
</ul>
<ol start="7" type="1">
<li><a href="demo/7.html">对象不支持此属性或方法</a></li>
<li><a href="demo/7.html">Script error.</a></li>
<li>HTML Parsing Error: Unable to modify the parent container element before the child element is closed (KB927917)</li>
</ol>
<ul>
<li>方案: 1.dom操作在dom ready之后</li>
</ul>
<p>5. <img src="error/script-error.jpg" alt="线上JS错误日志" /> http://trac.webkit.org/browser/branches/chromium/648/Source/WebCore/dom/ScriptExecutionContext.cpp?rev=77122#L301</p>
<p>window.external.msSiteModeCreateJumplist(&quot;担保交易&quot;)</p>
<ul>
<li>一般是将一个非 函数/方法 当作 函数/方法 调用时造成。 检查代码中是否有函数名与元素属性/属性同名的情况。貌似 IE 专有异常，同样的代码其他浏览器的异常信息与此不同。</li>
</ul></li>
<li>权限</li>
<li>语法错误</li>
<li>加载异常</li>
<li><p>线上环境错误检查（PE统计） <img src="error/error.png" alt="线上JS错误日志" /></p></li>
</ul>
<h3 id="javascript错误监控机制">Javascript错误监控机制</h3>
<ul>
<li>后端工程师较前端工程师最大的便利之一就是：良好的代码监控机制</li>
<li>异常处理原理 <img src="error/error-flow.jpg" alt="JS错误处理流程" /> 如上图所示，一个错误发生后，首先会被try-catch处理，如果没有被停止，则继续传递给window.onerror处理，如果没有被停止，则最终传递给浏览器控制台处理 -</li>
</ul>
<pre><code>var jq = $ = require(&#39;jquery&#39;); =&gt; $ 全局变量覆盖JUI，导致页面报错</code></pre>
<p><code>try - catch  try {     M.unexistMethod(); } catch(ex) {     alert(ex.message);     // IE: &quot;Object does't support this property or method&quot;     // FF: &quot;M.unexistMethod is not a function&quot;     // Chrome: &quot;Object # has no method 'unexistMethod'&quot; }</code></p>
<pre><code>window - onerror
window.onerror = function(msg, url, line) {
    alert(msg + &#39;:&#39; + line);
    // IE:&quot;Object does&#39;t support this property or method:7&quot;
    // FF:&quot;Script error.:0&quot;
    // Chrome:&quot;Script error.:0&quot;
};
M.unexistMethod();</code></pre>
<blockquote>
<p>“Script error.”,”&quot;, 0 Access-Control-Allow-Origin: *</p>
</blockquote>
<pre><code>  var a = {};
  a.a();
  
  Browser Message
  IE  对象不支持此属性或方法
  Firefox a.a is not a function
  Opera &#39;a.a&#39; is not a function
  Safari  &#39;undefined&#39; is not a function
  Chrome  Object # has no method &#39;a&#39;</code></pre>
<h3 id="参考资料">参考资料</h3>
<ul>
<li><a href="https://gist.github.com/neekey/4371159">浏览器错误捕捉总结</a></li>
</ul>
</body>
</html>
